<!DOCTYPE html>
<html class="no-js" lang="en-US">
<head>
  <base href="http://blog.coderzh.com/">
  <script type="text/javascript">
 
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X=[].slice,Y={}.hasOwnProperty,Z=function(a,b){function c(){this.constructor=a}for(var d in b)Y.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},$=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};for(u={catchupTime:100,initialRate:.03,minTime:250,ghostTime:100,maxProgressPerFrame:20,easeFactor:1.25,startOnPageLoad:!0,restartOnPushState:!0,restartOnRequestAfter:500,target:"body",elements:{checkInterval:100,selectors:["body"]},eventLag:{minSamples:10,sampleCount:3,lagThreshold:3},ajax:{trackMethods:["GET"],trackWebSockets:!0,ignoreURLs:[]}},C=function(){var a;return null!=(a="undefined"!=typeof performance&&null!==performance&&"function"==typeof performance.now?performance.now():void 0)?a:+new Date},E=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,t=window.cancelAnimationFrame||window.mozCancelAnimationFrame,null==E&&(E=function(a){return setTimeout(a,50)},t=function(a){return clearTimeout(a)}),G=function(a){var b,c;return b=C(),(c=function(){var d;return d=C()-b,d>=33?(b=C(),a(d,function(){return E(c)})):setTimeout(c,33-d)})()},F=function(){var a,b,c;return c=arguments[0],b=arguments[1],a=3<=arguments.length?X.call(arguments,2):[],"function"==typeof c[b]?c[b].apply(c,a):c[b]},v=function(){var a,b,c,d,e,f,g;for(b=arguments[0],d=2<=arguments.length?X.call(arguments,1):[],f=0,g=d.length;g>f;f++)if(c=d[f])for(a in c)Y.call(c,a)&&(e=c[a],null!=b[a]&&"object"==typeof b[a]&&null!=e&&"object"==typeof e?v(b[a],e):b[a]=e);return b},q=function(a){var b,c,d,e,f;for(c=b=0,e=0,f=a.length;f>e;e++)d=a[e],c+=Math.abs(d),b++;return c/b},x=function(a,b){var c,d,e;if(null==a&&(a="options"),null==b&&(b=!0),e=document.querySelector("[data-pace-"+a+"]")){if(c=e.getAttribute("data-pace-"+a),!b)return c;try{return JSON.parse(c)}catch(f){return d=f,"undefined"!=typeof console&&null!==console?console.error("Error parsing inline pace options",d):void 0}}},g=function(){function a(){}return a.prototype.on=function(a,b,c,d){var e;return null==d&&(d=!1),null==this.bindings&&(this.bindings={}),null==(e=this.bindings)[a]&&(e[a]=[]),this.bindings[a].push({handler:b,ctx:c,once:d})},a.prototype.once=function(a,b,c){return this.on(a,b,c,!0)},a.prototype.off=function(a,b){var c,d,e;if(null!=(null!=(d=this.bindings)?d[a]:void 0)){if(null==b)return delete this.bindings[a];for(c=0,e=[];c<this.bindings[a].length;)e.push(this.bindings[a][c].handler===b?this.bindings[a].splice(c,1):c++);return e}},a.prototype.trigger=function(){var a,b,c,d,e,f,g,h,i;if(c=arguments[0],a=2<=arguments.length?X.call(arguments,1):[],null!=(g=this.bindings)?g[c]:void 0){for(e=0,i=[];e<this.bindings[c].length;)h=this.bindings[c][e],d=h.handler,b=h.ctx,f=h.once,d.apply(null!=b?b:this,a),i.push(f?this.bindings[c].splice(e,1):e++);return i}},a}(),j=window.Pace||{},window.Pace=j,v(j,g.prototype),D=j.options=v({},u,window.paceOptions,x()),U=["ajax","document","eventLag","elements"],Q=0,S=U.length;S>Q;Q++)K=U[Q],D[K]===!0&&(D[K]=u[K]);i=function(a){function b(){return V=b.__super__.constructor.apply(this,arguments)}return Z(b,a),b}(Error),b=function(){function a(){this.progress=0}return a.prototype.getElement=function(){var a;if(null==this.el){if(a=document.querySelector(D.target),!a)throw new i;this.el=document.createElement("div"),this.el.className="pace pace-active",document.body.className=document.body.className.replace(/pace-done/g,""),document.body.className+=" pace-running",this.el.innerHTML='<div class="pace-progress">\n  <div class="pace-progress-inner"></div>\n</div>\n<div class="pace-activity"></div>',null!=a.firstChild?a.insertBefore(this.el,a.firstChild):a.appendChild(this.el)}return this.el},a.prototype.finish=function(){var a;return a=this.getElement(),a.className=a.className.replace("pace-active",""),a.className+=" pace-inactive",document.body.className=document.body.className.replace("pace-running",""),document.body.className+=" pace-done"},a.prototype.update=function(a){return this.progress=a,this.render()},a.prototype.destroy=function(){try{this.getElement().parentNode.removeChild(this.getElement())}catch(a){i=a}return this.el=void 0},a.prototype.render=function(){var a,b,c,d,e,f,g;if(null==document.querySelector(D.target))return!1;for(a=this.getElement(),d="translate3d("+this.progress+"%, 0, 0)",g=["webkitTransform","msTransform","transform"],e=0,f=g.length;f>e;e++)b=g[e],a.children[0].style[b]=d;return(!this.lastRenderedProgress||this.lastRenderedProgress|0!==this.progress|0)&&(a.children[0].setAttribute("data-progress-text",""+(0|this.progress)+"%"),this.progress>=100?c="99":(c=this.progress<10?"0":"",c+=0|this.progress),a.children[0].setAttribute("data-progress",""+c)),this.lastRenderedProgress=this.progress},a.prototype.done=function(){return this.progress>=100},a}(),h=function(){function a(){this.bindings={}}return a.prototype.trigger=function(a,b){var c,d,e,f,g;if(null!=this.bindings[a]){for(f=this.bindings[a],g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.call(this,b));return g}},a.prototype.on=function(a,b){var c;return null==(c=this.bindings)[a]&&(c[a]=[]),this.bindings[a].push(b)},a}(),P=window.XMLHttpRequest,O=window.XDomainRequest,N=window.WebSocket,w=function(a,b){var c,d,e;e=[];for(d in b.prototype)try{e.push(null==a[d]&&"function"!=typeof b[d]?"function"==typeof Object.defineProperty?Object.defineProperty(a,d,{get:function(){return b.prototype[d]},configurable:!0,enumerable:!0}):a[d]=b.prototype[d]:void 0)}catch(f){c=f}return e},A=[],j.ignore=function(){var a,b,c;return b=arguments[0],a=2<=arguments.length?X.call(arguments,1):[],A.unshift("ignore"),c=b.apply(null,a),A.shift(),c},j.track=function(){var a,b,c;return b=arguments[0],a=2<=arguments.length?X.call(arguments,1):[],A.unshift("track"),c=b.apply(null,a),A.shift(),c},J=function(a){var b;if(null==a&&(a="GET"),"track"===A[0])return"force";if(!A.length&&D.ajax){if("socket"===a&&D.ajax.trackWebSockets)return!0;if(b=a.toUpperCase(),$.call(D.ajax.trackMethods,b)>=0)return!0}return!1},k=function(a){function b(){var a,c=this;b.__super__.constructor.apply(this,arguments),a=function(a){var b;return b=a.open,a.open=function(d,e){return J(d)&&c.trigger("request",{type:d,url:e,request:a}),b.apply(a,arguments)}},window.XMLHttpRequest=function(b){var c;return c=new P(b),a(c),c};try{w(window.XMLHttpRequest,P)}catch(d){}if(null!=O){window.XDomainRequest=function(){var b;return b=new O,a(b),b};try{w(window.XDomainRequest,O)}catch(d){}}if(null!=N&&D.ajax.trackWebSockets){window.WebSocket=function(a,b){var d;return d=null!=b?new N(a,b):new N(a),J("socket")&&c.trigger("request",{type:"socket",url:a,protocols:b,request:d}),d};try{w(window.WebSocket,N)}catch(d){}}}return Z(b,a),b}(h),R=null,y=function(){return null==R&&(R=new k),R},I=function(a){var b,c,d,e;for(e=D.ajax.ignoreURLs,c=0,d=e.length;d>c;c++)if(b=e[c],"string"==typeof b){if(-1!==a.indexOf(b))return!0}else if(b.test(a))return!0;return!1},y().on("request",function(b){var c,d,e,f,g;return f=b.type,e=b.request,g=b.url,I(g)?void 0:j.running||D.restartOnRequestAfter===!1&&"force"!==J(f)?void 0:(d=arguments,c=D.restartOnRequestAfter||0,"boolean"==typeof c&&(c=0),setTimeout(function(){var b,c,g,h,i,k;if(b="socket"===f?e.readyState<2:0<(h=e.readyState)&&4>h){for(j.restart(),i=j.sources,k=[],c=0,g=i.length;g>c;c++){if(K=i[c],K instanceof a){K.watch.apply(K,d);break}k.push(void 0)}return k}},c))}),a=function(){function a(){var a=this;this.elements=[],y().on("request",function(){return a.watch.apply(a,arguments)})}return a.prototype.watch=function(a){var b,c,d,e;return d=a.type,b=a.request,e=a.url,I(e)?void 0:(c="socket"===d?new n(b):new o(b),this.elements.push(c))},a}(),o=function(){function a(a){var b,c,d,e,f,g,h=this;if(this.progress=0,null!=window.ProgressEvent)for(c=null,a.addEventListener("progress",function(a){return h.progress=a.lengthComputable?100*a.loaded/a.total:h.progress+(100-h.progress)/2},!1),g=["load","abort","timeout","error"],d=0,e=g.length;e>d;d++)b=g[d],a.addEventListener(b,function(){return h.progress=100},!1);else f=a.onreadystatechange,a.onreadystatechange=function(){var b;return 0===(b=a.readyState)||4===b?h.progress=100:3===a.readyState&&(h.progress=50),"function"==typeof f?f.apply(null,arguments):void 0}}return a}(),n=function(){function a(a){var b,c,d,e,f=this;for(this.progress=0,e=["error","open"],c=0,d=e.length;d>c;c++)b=e[c],a.addEventListener(b,function(){return f.progress=100},!1)}return a}(),d=function(){function a(a){var b,c,d,f;for(null==a&&(a={}),this.elements=[],null==a.selectors&&(a.selectors=[]),f=a.selectors,c=0,d=f.length;d>c;c++)b=f[c],this.elements.push(new e(b))}return a}(),e=function(){function a(a){this.selector=a,this.progress=0,this.check()}return a.prototype.check=function(){var a=this;return document.querySelector(this.selector)?this.done():setTimeout(function(){return a.check()},D.elements.checkInterval)},a.prototype.done=function(){return this.progress=100},a}(),c=function(){function a(){var a,b,c=this;this.progress=null!=(b=this.states[document.readyState])?b:100,a=document.onreadystatechange,document.onreadystatechange=function(){return null!=c.states[document.readyState]&&(c.progress=c.states[document.readyState]),"function"==typeof a?a.apply(null,arguments):void 0}}return a.prototype.states={loading:0,interactive:50,complete:100},a}(),f=function(){function a(){var a,b,c,d,e,f=this;this.progress=0,a=0,e=[],d=0,c=C(),b=setInterval(function(){var g;return g=C()-c-50,c=C(),e.push(g),e.length>D.eventLag.sampleCount&&e.shift(),a=q(e),++d>=D.eventLag.minSamples&&a<D.eventLag.lagThreshold?(f.progress=100,clearInterval(b)):f.progress=100*(3/(a+3))},50)}return a}(),m=function(){function a(a){this.source=a,this.last=this.sinceLastUpdate=0,this.rate=D.initialRate,this.catchup=0,this.progress=this.lastProgress=0,null!=this.source&&(this.progress=F(this.source,"progress"))}return a.prototype.tick=function(a,b){var c;return null==b&&(b=F(this.source,"progress")),b>=100&&(this.done=!0),b===this.last?this.sinceLastUpdate+=a:(this.sinceLastUpdate&&(this.rate=(b-this.last)/this.sinceLastUpdate),this.catchup=(b-this.progress)/D.catchupTime,this.sinceLastUpdate=0,this.last=b),b>this.progress&&(this.progress+=this.catchup*a),c=1-Math.pow(this.progress/100,D.easeFactor),this.progress+=c*this.rate*a,this.progress=Math.min(this.lastProgress+D.maxProgressPerFrame,this.progress),this.progress=Math.max(0,this.progress),this.progress=Math.min(100,this.progress),this.lastProgress=this.progress,this.progress},a}(),L=null,H=null,r=null,M=null,p=null,s=null,j.running=!1,z=function(){return D.restartOnPushState?j.restart():void 0},null!=window.history.pushState&&(T=window.history.pushState,window.history.pushState=function(){return z(),T.apply(window.history,arguments)}),null!=window.history.replaceState&&(W=window.history.replaceState,window.history.replaceState=function(){return z(),W.apply(window.history,arguments)}),l={ajax:a,elements:d,document:c,eventLag:f},(B=function(){var a,c,d,e,f,g,h,i;for(j.sources=L=[],g=["ajax","elements","document","eventLag"],c=0,e=g.length;e>c;c++)a=g[c],D[a]!==!1&&L.push(new l[a](D[a]));for(i=null!=(h=D.extraSources)?h:[],d=0,f=i.length;f>d;d++)K=i[d],L.push(new K(D));return j.bar=r=new b,H=[],M=new m})(),j.stop=function(){return j.trigger("stop"),j.running=!1,r.destroy(),s=!0,null!=p&&("function"==typeof t&&t(p),p=null),B()},j.restart=function(){return j.trigger("restart"),j.stop(),j.start()},j.go=function(){var a;return j.running=!0,r.render(),a=C(),s=!1,p=G(function(b,c){var d,e,f,g,h,i,k,l,n,o,p,q,t,u,v,w;for(l=100-r.progress,e=p=0,f=!0,i=q=0,u=L.length;u>q;i=++q)for(K=L[i],o=null!=H[i]?H[i]:H[i]=[],h=null!=(w=K.elements)?w:[K],k=t=0,v=h.length;v>t;k=++t)g=h[k],n=null!=o[k]?o[k]:o[k]=new m(g),f&=n.done,n.done||(e++,p+=n.tick(b));return d=p/e,r.update(M.tick(b,d)),r.done()||f||s?(r.update(100),j.trigger("done"),setTimeout(function(){return r.finish(),j.running=!1,j.trigger("hide")},Math.max(D.ghostTime,Math.max(D.minTime-(C()-a),0)))):c()})},j.start=function(a){v(D,a),j.running=!0;try{r.render()}catch(b){i=b}return document.querySelector(".pace")?(j.trigger("start"),j.go()):setTimeout(j.start,50)},"function"==typeof define&&define.amd?define(["pace"],function(){return j}):"object"==typeof exports?module.exports=j:D.startOnPageLoad&&j.start()}).call(this);
</script>
<style type="text/css">
   
  .pace {
    -webkit-pointer-events: none;
    pointer-events: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }

  .pace.pace-inactive .pace-progress {
    display: none;
  }

  .pace .pace-progress {
    position: fixed;
    z-index: 2000;
    top: 0;
    right: 45%;
    height: 5rem;
    width: 5rem;
  }

  .pace .pace-progress:after {
    display: block;
    position: absolute;
    top: 0;
    right: .5rem;
    content: attr(data-progress-text);
    font-family: "Helvetica Neue", sans-serif;
    font-weight: 100;
    font-size: 5rem;
    line-height: 1;
    text-align: right;
    color: rgba(229, 146, 42, 0.90);
  }
</style>

  <title>CoderZh&#39;s Blog - CoderZh&#39;s Blog</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="CoderZh&#39;s Blog">
<meta name="author" content="coderzh">
<meta name="publisher" content="coderzh">
<meta name="generator" content="http://gohugo.io/"/>

<meta itemprop="name" content="CoderZh&#39;s Blog - CoderZh&#39;s Blog">
<meta itemprop="description" content="CoderZh&#39;s Blog">
<meta itemprop="image" content="http://blog.coderzh.com/public/coderzh.jpg">

<meta property="og:title" content="CoderZh&#39;s Blog - CoderZh&#39;s Blog" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://blog.coderzh.com/" />
<meta property="og:image" content="http://blog.coderzh.com/public/coderzh.jpg" />
<meta property="og:description" content="CoderZh&#39;s Blog" />

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@coderzh">
<meta name="twitter:title" content="CoderZh&#39;s Blog - CoderZh&#39;s Blog">
<meta name="twitter:description" content="CoderZh&#39;s Blog">
<meta name="twitter:creator" content="@coderzh">
<meta name="twitter:image" content="http://blog.coderzh.com/public/coderzh.jpg">

  <script>document.documentElement.className = document.documentElement.className.replace("no-js", "js");</script>
  <link rel="canonical" href="http://blog.coderzh.com/">
  <link rel='shortlink' href="http://blog.coderzh.com/"/>
  <link rel="shortcut icon" href="http://blog.coderzh.com/public/favicon.ico"/>
  
  <link href="http://blog.coderzh.com/feed.xml" rel="alternate" type="application/rss+xml" title="CoderZh&#39;s Blog" />


<link rel="stylesheet" id="human-style-css" href="http://blog.coderzh.com/wp-content/themes/hueman/style.css" type="text/css" media="all"/>
<link rel="stylesheet" id="human-style-css2" href="http://blog.coderzh.com/wp-content/themes/hueman-child/style.css" type="text/css" media="all"/>
<link rel="stylesheet" id="responsive-css" href="http://blog.coderzh.com/wp-content/themes/hueman/responsive.css" type="text/css" media="all"/>
<link rel="stylesheet" id="font-awesome-css" href="http://blog.coderzh.com/wp-content/themes/hueman/fonts/font-awesome.min.css" type="text/css" media="all"/>
<link rel="stylesheet" id="wp-youtube-lyte" href="http://blog.coderzh.com/wp-content/plugins/wp-youtube-lyte/lyte/lyte.css" type="text/css" media="all"/>
<link rel="stylesheet" id="hubinfo" href="http://blog.coderzh.com/assets/hubinfo/dist/hubinfo.css" type="text/css" media="all"/>
<link rel="stylesheet" href="http://blog.coderzh.com/public/highlightjs/default.min.css">
<script src="http://blog.coderzh.com/public/highlightjs/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<link rel="stylesheet" id="human-style-css3" href="http://blog.coderzh.com/wp-content/themes/hueman-child/user.css" type="text/css" media="all"/>


</head>

<body class="archive category col-3cm full-width topbar-enabled chrome">

<div id="wrapper">
  <header id="header">

  <nav class="nav-container group" id="nav-topbar">
    <div class="nav-toggle"><i class="fa fa-bars"></i></div>
    <div class="nav-text"></div>
    <div class="nav-wrap container">
      <a href="http://blog.coderzh.com" class="nav-cs-icon">
        <img width="40" height="40" src="http://blog.coderzh.com/public/coderzh.jpg" alt="coderzh" title="Home">
      </a>
      <ul id="menu-default-menu" class="nav container-inner group">
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a href="http://blog.coderzh.com/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0">读书笔记</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a href="http://blog.coderzh.com/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0">技术文章</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a href="http://blog.coderzh.com/categories/%E6%80%9D%E8%80%83%E6%84%9F%E6%82%9F">思考感悟</a>
        </li>
        
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a href="http://blog.coderzh.com/post/">归档</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a href="http://blog.coderzh.com/about/">关于我</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a href="http://blog.coderzh.com/feed.xml" type="application/rss+xml" target="_blank">订阅</a>
        </li>
        <li class="menu-item menu-item-type-post_type menu-item-text">
        一个程序员的思考与总结
        </li>
      </ul>
    </div>

    <div class="container">
      <div class="container-inner">
        <div class="toggle-search"><i class="fa fa-search"></i></div>
        <div class="search-expand">
          <div class="search-expand-inner">
            <form method="get" class="searchform themeform" action="https://www.google.com/search">
              <div>
                <input type="text" class="search" name="q" placeholder="Press enter to start searching">
              </div>
            </form>
          </div>
        </div>
      </div>
      
    </div>
    

  </nav>
  

  <div class="container group">
    <div class="container-inner">

      <div class="group pad">

        <div class="group pad">
          <h1 class="site-title">
            <a href="http://blog.coderzh.com" rel="home">
              <img style="border-radius: 50%;width:72px;height:72px;margin:0 auto;" src="http://blog.coderzh.com/public/coderzh.jpg"></img>
              CoderZh&#39;s Blog
            </a>
          </h1>
          <p class="site-description"> 如果你没有感觉到时间不够用时，你多半正在虚度光阴。 </p>
        </div>

      </div>
    </div>
    
  </div>
  

</header>



  <div class="container" id="page">
    <div class="container-inner">
      <div class="main">
        <div class="main-inner group">
          <section class="content">
            <div class="pad group">
              
              
              <div class="post-list group">
                
                  
                
                  
                    
                      <div class="post-row">
                    

                      <article class="post type-post status-publish format-standard has-post-thumbnail hentry group">
  <div class="post-inner post-hover">
    <div class="post-meta group">
  <p class="post-category">
    
    <a href="http://blog.coderzh.com/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/" title="All posts in 技术文章" rel="category tag">技术文章</a>
    
  </p>

  <p class="post-date">2009年04月06日</p>
</div>

<h2 class="post-title">
  <a href="http://blog.coderzh.com/2009/04/06/1430396" rel="bookmark" title="玩转Google开源C&#43;&#43;单元测试框架Google Test系列(gtest)之三 - 事件机制">玩转Google开源C&#43;&#43;单元测试框架Google Test系列(gtest)之三 - 事件机制</a>
</h2>

<div class="entry excerpt">
  <p>一、前言 gtest提供了多种事件机制，非常方便我们在案例之前或之后做一些操作。总结一下gtest的事件一共有3种： 全局的，所有案例执行前后。 TestSuite级别的，在某一批案例中第一个案例前，最后一个案例执行后。 TestCase级别的，每个TestCase前后。 二、全局事件 要实现全局事件，必须写一个类，继承testing::Environment类，实现里面的SetUp和TearDown方法。 SetUp()方法在所有案例执行前执行 TearDown()方法在所有案例执行后执行 class&nbsp;FooEnvironment&nbsp;:&nbsp;public&nbsp;testing::Environment { public: &nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;void&nbsp;SetUp() &nbsp;&nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;std::cout&nbsp;&lt;&lt;&nbsp;"Foo&nbsp;FooEnvironment&nbsp;SetUP"&nbsp;&lt;&lt;&nbsp;std::endl; &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;void&nbsp;TearDown() &nbsp;&nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;std::cout&nbsp;&lt;&lt;&nbsp;"Foo&nbsp;FooEnvironment&nbsp;TearDown"&nbsp;&lt;&lt;&nbsp;std::endl; &nbsp;&nbsp;&nbsp;&nbsp;} }; &nbsp; 当然，这样还不够，我们还需要告诉gtest添加这个全局事件，我们需要在main函数中通过testing::AddGlobalTestEnvironment方法将事件挂进来，也就是说，我们可以写很多个这样的类，然后将他们的事件都挂上去。 int&nbsp;_tmain(int&nbsp;argc,&nbsp;_TCHAR*&nbsp;argv[]) { &nbsp;&nbsp;&nbsp;&nbsp;testing::AddGlobalTestEnvironment(new&nbsp;FooEnvironment); &nbsp;&nbsp;&nbsp;&nbsp;testing::InitGoogleTest(&amp;argc,&nbsp;argv); &nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;RUN_ALL_TESTS(); } &nbsp; 三、TestSuite事件 我们需要写一个类，继承testing::Test，然后实现两个静态方法 1. SetUpTestCase() 方法在第一个TestCase之前执行 TearDownTestCase() 方法在最后一个TestCase之后执行 &lt;!&ndash; Code highlighting produced by Actipro CodeHighlighter (freeware) http://www.CodeHighlighter.com/ &ndash;&gt;class&nbsp;FooTest&nbsp;:&nbsp;public&nbsp;testing::Test&nbsp;{ &nbsp;protected: &nbsp;&nbsp;static&nbsp;void&nbsp;SetUpTestCase()&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;sharedresource&nbsp;=&nbsp;new&nbsp;; &nbsp;&nbsp;} &nbsp;&nbsp;static&nbsp;void&nbsp;TearDownTestCase()&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;delete&nbsp;sharedresource; &nbsp;&nbsp;&nbsp;&nbsp;sharedresource&nbsp;=&nbsp;NULL; &nbsp;&nbsp;} &nbsp;&nbsp;//&nbsp;Some&nbsp;expensive&nbsp;resource&nbsp;shared&nbsp;by&nbsp;all&nbsp;tests. &nbsp;&nbsp;static&nbsp;T*&nbsp;sharedresource; }; 在编写测试案例时，我们需要使用TEST_F这个宏，第一个参数必须是我们上面类的名字，代表一个TestSuite。 &lt;!&ndash; Code highlighting produced by Actipro CodeHighlighter (freeware) http://www.CodeHighlighter.com/ &ndash;&gt;TEST_F(FooTest,&nbsp;Test1) &nbsp;{</p>
</div>


  </div>
  
</article>



                    
                  
                
                  
                    

                      <article class="post type-post status-publish format-standard has-post-thumbnail hentry group">
  <div class="post-inner post-hover">
    <div class="post-meta group">
  <p class="post-category">
    
    <a href="http://blog.coderzh.com/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/" title="All posts in 技术文章" rel="category tag">技术文章</a>
    
  </p>

  <p class="post-date">2009年04月06日</p>
</div>

<h2 class="post-title">
  <a href="http://blog.coderzh.com/2009/04/06/1430364" rel="bookmark" title="玩转Google开源C&#43;&#43;单元测试框架Google Test系列(gtest)之二 - 断言">玩转Google开源C&#43;&#43;单元测试框架Google Test系列(gtest)之二 - 断言</a>
</h2>

<div class="entry excerpt">
  <p>一、前言 这篇文章主要总结gtest中的所有断言相关的宏。 gtest中，断言的宏可以理解为分为两类，一类是ASSERT系列，一类是EXPECT系列。一个直观的解释就是： ASSERT_* 系列的断言，当检查点失败时，退出当前函数（注意：并非退出当前案例）。 EXPECT_* 系列的断言，当检查点失败时，继续往下执行。 二、示例 //&nbsp;int型比较，预期值：3，实际值：Add(1,&nbsp;2) EXPECT_EQ(3,&nbsp;Add(1,&nbsp;2)) //&nbsp;![](http://www.cnblogs.com/Images/dot.gif) &nbsp; 假如你的Add(1, 2) 结果为4的话，会在结果中输出： &lt;!&ndash; Code highlighting produced by Actipro CodeHighlighter (freeware) http://www.CodeHighlighter.com/ &ndash;&gt;g:\myproject\c++\gtestdemo\gtestdemo\gtestdemo.cpp(16):&nbsp;error:&nbsp;Value&nbsp;of:&nbsp;Add(1,&nbsp;2) &nbsp;&nbsp;Actual: 4 Expected:3 如果是将结果输出到xml里的话，将输出：（关于将结果输出为xml，见：http://www.cnblogs.com/coderzh/archive/2009/04/10/1432789.html） &lt;testcase&nbsp;name="Demo"&nbsp;status="run"&nbsp;time="0"&nbsp;classname="AddTest"&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;failure&nbsp;message="Value&nbsp;of:&nbsp;Add(1,&nbsp;2) &nbsp;&nbsp;Actual: 4 Expected: 3"&nbsp;type=""&gt;&lt;![CDATA[g:\myproject\c++\gtestdemo\gtestdemo\gtestdemo.cpp:16 Value&nbsp;of:&nbsp;Add(1,&nbsp;2) &nbsp;&nbsp;Actual: 4 Expected: 3]]&gt;&lt;/failure&gt; &lt;/testcase&gt; &nbsp; 如果你对自动输出的出错信息不满意的话，你还可以通过操作符&lt;&lt;将一些自定义的信息输出，通常，这对于调试或是对一些检查点的补充说明来说，非常有用！ 下面举个例子： 如果不使用&lt;&lt;操作符自定义输出的话： for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;x.size();&nbsp;++i) { &nbsp;&nbsp;&nbsp;&nbsp;EXPECT_EQ(x[i],&nbsp;y[i]); } 看到的结果将是这样的，你根本不知道出错时 i 等于几： g:\myproject\c++\gtestdemo\gtestdemo\gtestdemo.cpp(25):&nbsp;error:&nbsp;Value&nbsp;of:&nbsp;y[i] &nbsp;&nbsp;Actual:&nbsp;4 Expected:&nbsp;x[i] Which&nbsp;is:&nbsp;3 &nbsp; 如果使用&lt;&lt;操作符将一些重要信息输出的话： for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;x.size();&nbsp;++i) { &nbsp;&nbsp;&nbsp;&nbsp;EXPECT_EQ(x[i],&nbsp;y[i])&nbsp;&lt;&lt;&nbsp;"Vectors&nbsp;x&nbsp;and&nbsp;y&nbsp;differ&nbsp;at&nbsp;index&nbsp;"&nbsp;&lt;&lt;&nbsp;i; } 从输出结果中就可以定位到在 i = 2 时出现了错误。这样的输出结果看起来更加有用，容易理解：&nbsp; &lt;!&ndash; Code highlighting produced by Actipro CodeHighlighter (freeware) http://www.CodeHighlighter.com/ &ndash;&gt;g:\myproject\c++\gtestdemo\gtestdemo\gtestdemo.cpp(25):&nbsp;error:&nbsp;Value&nbsp;of:&nbsp;y[i] &nbsp;&nbsp;Actual:&nbsp;4 Expected:&nbsp;x[i] Which&nbsp;is:&nbsp;3 Vectors&nbsp;x&nbsp;and&nbsp;y&nbsp;differ&nbsp;at&nbsp;index&nbsp;2 &nbsp; 三、布尔值检查 **Fatal assertion** **Nonfatal assertion** **Verifies** ASSERT_TRUE(_condition_); EXPECT_TRUE(_condition_); _condition_ is true ASSERT_FALSE(_condition_); EXPECT_FALSE(_condition_); _condition_ is false &nbsp; 四、数值型数据检查 **Fatal assertion** **Nonfatal assertion** **Verifies** ASSERT_EQ(_expected_, _actual_); EXPECT_EQ(_expected_, _actual_); _expected_ == _actual_ ASSERT_NE(_val1_, _val2_); EXPECT_NE(_val1_, _val2_); _val1_ != _val2_ ASSERT_LT(_val1_, _val2_); EXPECT_LT(_val1_, _val2_); _val1_ &lt; _val2_ ASSERT_LE(_val1_, _val2_); EXPECT_LE(_val1_, _val2_); _val1_ &lt;= _val2_ ASSERT_GT(_val1_, _val2_); EXPECT_GT(_val1_, _val2_); _val1_ &gt; _val2_ ASSERT_GE(_val1_, _val2_); EXPECT_GE(_val1_, _val2_); _val1_ &gt;= _val2_ &nbsp; 五、字符串检查 **Fatal assertion** **Nonfatal assertion** **Verifies** ASSERT_STREQ(_expected_str_, _actual_str_); EXPECT_STREQ(_expected_str_, _actual_str_); the two C strings have the same content ASSERT_STRNE(_str1_, _str2_); EXPECT_STRNE(_str1_, _str2_); the two C strings have different content ASSERT_STRCASEEQ(_expected_str_, _actual_str_); EXPECT_STRCASEEQ(_expected_str_, _actual_str_); the two C strings have the same content, ignoring case ASSERT_STRCASENE(_str1_, _str2_); EXPECT_STRCASENE(_str1_, _str2_); the two C strings have different content, ignoring case &nbsp; STREQ*和*STRNE*同时支持char*和wchar_t类型的，*STRCASEEQ*和*STRCASENE*却只接收char*，估计是不常用吧。下面是几个例子： TEST(StringCmpTest,&nbsp;Demo) { &nbsp;&nbsp;&nbsp;&nbsp;char*&nbsp;pszCoderZh&nbsp;=&nbsp;"CoderZh"; &nbsp;&nbsp;&nbsp;&nbsp;wchar_t*&nbsp;wszCoderZh&nbsp;=&nbsp;L"CoderZh"; &nbsp;&nbsp;&nbsp;&nbsp;std::string&nbsp;strCoderZh&nbsp;=&nbsp;"CoderZh"; &nbsp;&nbsp;&nbsp;&nbsp;std::wstring&nbsp;wstrCoderZh&nbsp;=&nbsp;L"CoderZh"; &nbsp;&nbsp;&nbsp;&nbsp;EXPECT_STREQ("CoderZh",&nbsp;pszCoderZh); &nbsp;&nbsp;&nbsp;&nbsp;EXPECT_STREQ(L"CoderZh",&nbsp;wszCoderZh); &nbsp;&nbsp;&nbsp;&nbsp;EXPECT_STRNE("CnBlogs",&nbsp;pszCoderZh); &nbsp;&nbsp;&nbsp;&nbsp;EXPECT_STRNE(L"CnBlogs",&nbsp;wszCoderZh); &nbsp;&nbsp;&nbsp;&nbsp;EXPECT_STRCASEEQ("coderzh",&nbsp;pszCoderZh); &nbsp;&nbsp;&nbsp;&nbsp;//EXPECT_STRCASEEQ(L"coderzh",&nbsp;wszCoderZh);&nbsp;&nbsp;&nbsp;&nbsp;不支持 &nbsp;&nbsp;&nbsp;&nbsp;EXPECT_STREQ("CoderZh",&nbsp;strCoderZh.c_str()); &nbsp;&nbsp;&nbsp;&nbsp;EXPECT_STREQ(L"CoderZh",&nbsp;wstrCoderZh.c_str()); } &nbsp; 六、显示返回成功或失败 直接返回成功：SUCCEED(); 返回失败： **Fatal assertion** **Nonfatal assertion** FAIL(); ADD_FAILURE(); &nbsp; TEST(ExplicitTest,&nbsp;Demo) { &nbsp;&nbsp;&nbsp;&nbsp;ADD_FAILURE()&nbsp;&lt;&lt;&nbsp;"Sorry";&nbsp;//&nbsp;None&nbsp;Fatal&nbsp;Asserton，继续往下执行。 &nbsp;&nbsp;&nbsp;&nbsp;//FAIL();&nbsp;//&nbsp;Fatal&nbsp;Assertion，不往下执行该案例。 &nbsp;&nbsp;&nbsp;&nbsp;SUCCEED(); } 七、异常检查 **Fatal assertion** **Nonfatal assertion** **Verifies** ASSERT_THROW(_statement_, _exception_type_); EXPECT_THROW(_statement_, _exception_type_); _statement_ throws an exception of the given type ASSERT_ANY_THROW(_statement_); EXPECT_ANY_THROW(_statement_); _statement_ throws an exception of any type ASSERT_NO_THROW(_statement_); EXPECT_NO_THROW(_statement_); _statement_ doesn't throw any exception &nbsp; 例如： int&nbsp;Foo(int&nbsp;a,&nbsp;int&nbsp;b) { &nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(a&nbsp;==&nbsp;0&nbsp;||&nbsp;b&nbsp;==&nbsp;0) &nbsp;&nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;"don't&nbsp;do&nbsp;that"; &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;c&nbsp;=&nbsp;a&nbsp;%&nbsp;b; &nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c&nbsp;==&nbsp;0) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;b; &nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Foo(b,&nbsp;c); } TEST(FooTest,&nbsp;HandleZeroInput) { &nbsp;&nbsp;&nbsp;&nbsp;EXPECT_ANY_THROW(Foo(10,&nbsp;0)); &nbsp;&nbsp;&nbsp;&nbsp;EXPECT_THROW(Foo(0,&nbsp;5),&nbsp;char*); } 八、Predicate Assertions 在使用EXPECT_TRUE或ASSERT_TRUE时，有时希望能够输出更加详细的信息，比如检查一个函数的返回值TRUE还是FALSE时，希望能够输出传入的参数是什么，以便失败后好跟踪。因此提供了如下的断言： **Fatal assertion** **Nonfatal assertion** **Verifies** ASSERT_PRED1(_pred1, val1_); EXPECT_PRED1(_pred1, val1_); _pred1(val1)_ returns true ASSERT_PRED2(_pred2, val1, val2_); EXPECT_PRED2(_pred2, val1, val2_); _pred2(val1, val2)_ returns true ...</p>
</div>


  </div>
  
</article>



                    
                      </div>
                    
                  
                
                  
                    
                      <div class="post-row">
                    

                      <article class="post type-post status-publish format-standard has-post-thumbnail hentry group">
  <div class="post-inner post-hover">
    <div class="post-meta group">
  <p class="post-category">
    
    <a href="http://blog.coderzh.com/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/" title="All posts in 技术文章" rel="category tag">技术文章</a>
    
  </p>

  <p class="post-date">2009年04月05日</p>
</div>

<h2 class="post-title">
  <a href="http://blog.coderzh.com/2009/04/05/1429858" rel="bookmark" title="CCNET&#43;MSBuild&#43;SVN实时构建的优化总结">CCNET&#43;MSBuild&#43;SVN实时构建的优化总结</a>
</h2>

<div class="entry excerpt">
  <p>本文不是介绍如何使用CCNET+MSBuild+SVN构建自动编译系统，相关的内容可以从很多地方获取，可以再园子里搜一下。 随着我们的SVN库日益壮大，容量达到10G,几十G 甚至更大时，我们发现自动构建速度越来越慢，直到有一天你发现入了很小一段代码却不得不等待几小时构建完成，程序员的忍受是有极限的，因此我们决定采取措施实施优化。 首先，我们必须分析哪些因素导致了我们构建速度的减慢，罗列一下，大概如下几个方面： SVN库太大，使得构建服务器在更新SVN代码时花费大量时间。 SVN库里有很多工程，每当有SVN代码更新的时候，CCNET就会调用MSBuild将我们所有的工程都编译一遍。（即使入库的文件根本不需要编译，如python脚本） SVN库中工程量越来越大，导致编译所有工程时间原来越长。 对于第三点，我们没有办法，但对于前两点，我们是有办法解决的，总结一下要做的事情：一是加快SVN更新速度，二是减少不必要的工程编译次数。 一、加快SVN更新速度 SVN的更新操作是有CCNET发起的，服务每隔一段时间查询一次SVN是否更新（看CCNET源码好像是调用svn &ndash;log来获取代码更新信息），如果有文件更新，则调用svn &ndash;update进行更新。从CCNET源码看来，CCNET对SVN代码的更新应该是针对性的，即，查询到哪部分代码有更新，就只更新那部分代码。这样的话效率应该不差。但在实际过程中，发现CCNET调用SVN更新速度异常的慢，甚至让我怀疑它是对整个SVN库执行了一次update操作。 要加快SVN更新速度，我们想到的是减少SVN更新的文件范围，假如你入库了一个python代码，或是QTP测试案例，因为无需编译，所以构建服务器甚至不需要更新那部分代码。因此，我们可以在CCNET的配置文件中只配置我们需要编译的工程： &lt;sourcecontrol&nbsp;type="multi"&gt; &nbsp;&nbsp;&nbsp;&nbsp;&lt;sourceControls&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;svn&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;trunkUrl&gt;http://xxx/projectA&lt;/trunkUrl&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;workingDirectory&gt;x:\ccnet\svn\projctA&lt;/workingDirectory&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;username&gt;name&lt;/username&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;password&gt;pwd&lt;/password&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;executable&gt;x:\ccnet\Subversion\svn.exe&lt;/executable&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/svn&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;svn&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;trunkUrl&gt;http://xxx/projectB&lt;/trunkUrl&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;workingDirectory&gt;x:\ccnet\svn\projctB&lt;/workingDirectory&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;username&gt;name&lt;/username&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;password&gt;pwd&lt;/password&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;executable&gt;x:\ccnet\Subversion\svn.exe&lt;/executable&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/svn&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;svn&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;trunkUrl&gt;http://xxx/projectC&lt;/trunkUrl&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;workingDirectory&gt;x:\ccnet\svn\projctC&lt;/workingDirectory&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;username&gt;name&lt;/username&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;password&gt;pwd&lt;/password&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;executable&gt;x:\ccnet\Subversion\svn.exe&lt;/executable&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/svn&gt; &nbsp;&nbsp;&nbsp;&nbsp;&lt;/sourceControls&gt; &lt;/sourcecontrol&gt; 通过上面的设置，CCNET就是监视我们上面指定的SVN路径的代码更新了，如果你的SVN库中有大量不需要编译的文件，这样的优化带来的效果是巨大的。 二、减少编译次数 上面解决了对入库不需要编译的代码文件的问题，但我们还需要面临一个问题是，当你入库工程A的代码时，你只希望编译工程A，而不是将工程A，B，C都编译一遍。甚至，可能还有更加严格的要求。比如，我们库中有个公共库的工程FrameworkA，工程ProjectA，ProjectB，ProjectC都使用到了该公共库工程。我们希望做到： 当我入库的代码属于FrameworkA时，希望把ProjectA，ProjectB，ProjectC都编译一遍。（因为我修改了公共库，很有可能导致工程A,B,C编译不过。） 当我入库的是ProjectA(或B,C)时，我只希望编译ProjectA(或B,C)就行了。 我们看到我们的工程之间多了一些内在的联系，如何才能处理这种复杂的编译关系呢？我想到的是，要么在CCNET上做手脚，要么在MSBuild上进行扩展。CCNET是一个开源项目，我完全可以修改它的代码为我所用，甚至修改出一个更适合使用的版本提交上去 ，但发现这样做的工程量太大，需要花费的精力太多。我需要找到一个简单的，又容易实现的方案，达到我们上面的两点需求。因此，我选择了对MSBuild进行扩展，而MSBuild本事又是支持这种扩展的，这给我带来了很大的方便。 熟悉MSBuild配置文件的朋友一定知道里面有很多Task供我们使用，比如:CallTarget，Exec，MakeDir，VCBuild等等。同时，也提供机制让我们实现自己的自定义Task。详细使用可以参考微软的文档：How to write a Task 现在，我们可以实现一个自己的Task了，那么在我们自定义的这个Task里，我们应该做些什么呢？恩，再来整理一下思路： 我们需要知道更新的代码属于哪个工程。 我们需要知道编译该工程的同时，还需要编译哪些与之相关的工程。 首先解决第一个问题，如何知道更新的代码属于哪个工程？其实，一个更加实际的问题，如何知道更新了哪些代码？ 我曾经尝试过使用CCNET一样的办法，调用svn &ndash;log对入库记录进行查询，然后每次保存好上次更新的状态，再判断这次更新相对于上次改动了哪些。做到这些其实非常容易，但是，存在一个问题，CCNET本身也有一个机制在记录着SVN更新的状态（state文件），如果我又记录一个自己的SVN更新历史的文件，可能和CCNET本身记录的有时间差，使得整个流程下来对于要更新的和编译的代码文件变得非常不确定。因此，我最后打算直接使用CCNET获取到的文件更新列表。要获取CCNET获取的SVN更新列表，只需要在CCNET的配置文件中加入下面一段： &lt;prebuild&gt; &nbsp;&nbsp;&nbsp;&nbsp;&lt;modificationWriter&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;filename&gt;mods.xml&lt;/filename&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;path&gt;x:\ccnet\svn\build&lt;/path&gt; &nbsp;&nbsp;&nbsp;&nbsp;&lt;/modificationWriter&gt; &lt;/prebuild&gt; &nbsp; 这样，每当CCNET更新SVN代码时，都会将SVN的更新记录到mods.xml中，mods.xml的格式大致如下： &lt;?xml&nbsp;version="1.0"&nbsp;encoding="utf-8"?&gt; &lt;ArrayOfModification&nbsp;xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&nbsp;xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt; &nbsp;&nbsp;&nbsp;&nbsp;&lt;Modification&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Type&gt;Modified&lt;/Type&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FileName&gt;xxx.cs&lt;/FileName&gt;</p>
</div>


  </div>
  
</article>



                    
                  
                
                  
                    

                      <article class="post type-post status-publish format-standard has-post-thumbnail hentry group">
  <div class="post-inner post-hover">
    <div class="post-meta group">
  <p class="post-category">
    
    <a href="http://blog.coderzh.com/categories/%E6%80%9D%E8%80%83%E6%84%9F%E6%82%9F/" title="All posts in 思考感悟" rel="category tag">思考感悟</a>
    
  </p>

  <p class="post-date">2009年03月29日</p>
</div>

<h2 class="post-title">
  <a href="http://blog.coderzh.com/2009/03/29/1424344" rel="bookmark" title="代码覆盖率浅谈">代码覆盖率浅谈</a>
</h2>

<div class="entry excerpt">
  <p>在做单元测试时，代码覆盖率常常被拿来作为衡量测试好坏的指标，甚至，用代码覆盖率来考核测试任务完成情况，比如，代码覆盖率必须达到80％或 90％。于是乎，测试人员费尽心思设计案例覆盖代码。用代码覆盖率来衡量，有利也有有弊。本文我们就代码覆盖率展开讨论，也欢迎同学们踊跃评论。 首先，让我们先来了解一下所谓的&#8220;代码覆盖率&#8221;。我找来了所谓的定义： 代码覆盖率 ＝ 代码的覆盖程度，一种度量方式。 上面简短精悍的文字非常准确的描述了代码覆盖率的含义。而代码覆盖程度的度量方式是有很多种的，这里介绍一下最常用的几种： 1. 语句覆盖(StatementCoverage) 又称行覆盖(LineCoverage)，段覆盖(SegmentCoverage)，基本块覆盖(BasicBlockCoverage)，这是最常用也是最常见的一种覆盖方式，就是度量被测代码中每个可执行语句是否被执行到了。这里说的是&#8220;可执行语句&#8221;，因此就不会包括像C＋＋的头文件声明，代码注释，空行，等等。非常好理解，只统计能够执行的代码被执行了多少行。需要注意的是，单独一行的花括号｛｝ 也常常被统计进去。语句覆盖常常被人指责为&#8220;最弱的覆盖&#8221;，它只管覆盖代码中的执行语句，却不考虑各种分支的组合等等。假如你的上司只要求你达到语句覆盖，那么你可以省下很多功夫，但是，换来的确实测试效果的不明显，很难更多地发现代码中的问题。 这里举一个不能再简单的例子，我们看下面的被测试代码： int&nbsp;foo(int&nbsp;a,&nbsp;int&nbsp;b) { &nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;a&nbsp;/&nbsp;b; } 假如我们的测试人员编写如下测试案例： TeseCase:&nbsp;a&nbsp;=&nbsp;10,&nbsp;b&nbsp;=&nbsp;5 测试人员的测试结果会告诉你，他的代码覆盖率达到了100％，并且所有测试案例都通过了。然而遗憾的是，我们的语句覆盖率达到了所谓的100%，但是却没有发现最简单的Bug，比如，当我让b=0时，会抛出一个除零异常。 正因如此，假如上面只要求测试人员语句覆盖率达到多少的话，测试人员只要钻钻空子，专门针对如何覆盖代码行编写测试案例，就很容易达到主管的要求。当然了，这同时说明了几个问题： &nbsp; &nbsp; 1.主管只使用语句覆盖率来考核测试人员本身就有问题。 &nbsp; &nbsp; 2.测试人员的目的是为了测好代码，钻如此的空子是缺乏职业道德的。 &nbsp; &nbsp; 3.是否应该采用更好的考核方式来考核测试人员的工作？ 为了寻求更好的考核标准，我们必须先了解完代码覆盖率到底还有哪些，如果你的主管只知道语句覆盖，行覆盖，那么你应该主动向他介绍还有更多的覆盖方式。比如： 2. 判定覆盖(DecisionCoverage) 又称分支覆盖(BranchCoverage)，所有边界覆盖(All-EdgesCoverage)，基本路径覆盖(BasicPathCoverage)，判定路径覆盖(Decision-Decision-Path)。它度量程序中每一个判定的分支是否都被测试到了。这句话是需要进一步理解的，应该非常容易和下面说到的条件覆盖混淆。因此我们直接介绍第三种覆盖方式，然后和判定覆盖一起来对比，就明白两者是怎么回事了。 3. 条件覆盖(ConditionCoverage) 它度量判定中的每个子表达式结果true和false是否被测试到了。为了说明判定覆盖和条件覆盖的区别，我们来举一个例子，假如我们的被测代码如下： int&nbsp;foo(int&nbsp;a,&nbsp;int&nbsp;b) { &nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(a&nbsp;&lt;&nbsp;10&nbsp;||&nbsp;b&nbsp;&lt;&nbsp;10) // 判定 &nbsp;&nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0; // 分支一 &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;else &nbsp;&nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1; // 分支二 &nbsp;&nbsp;&nbsp;&nbsp;} } 设计判定覆盖案例时，我们只需要考虑判定结果为true和false两种情况，因此，我们设计如下的案例就能达到判定覆盖率100％： TestCaes1:&nbsp;a&nbsp;=&nbsp;5,&nbsp;b&nbsp;＝&nbsp;任意数字&nbsp; 覆盖了分支一 TestCaes2:&nbsp;a&nbsp;=&nbsp;15,&nbsp;b&nbsp;=&nbsp;15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 覆盖了分支二 &nbsp; 设计条件覆盖案例时，我们需要考虑判定中的每个条件表达式结果，为了覆盖率达到100％，我们设计了如下的案例： TestCase1:&nbsp;a&nbsp;=&nbsp;5,&nbsp;b&nbsp;=&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; true,&nbsp; true TestCase4:&nbsp;a&nbsp;=&nbsp;15,&nbsp;b&nbsp;=&nbsp;15&nbsp;&nbsp; false,&nbsp;false 通过上面的例子，我们应该很清楚了判定覆盖和条件覆盖的区别。需要特别注意的是：条件覆盖不是将判定中的每个条件表达式的结果进行排列组合，而是只要每个条件表达式的结果true和false测试到了就OK了。因此，我们可以这样推论：完全的条件覆盖并不能保证完全的判定覆盖。比如上面的例子，假如我设计的案例为： TestCase1:&nbsp;a&nbsp;=&nbsp;5,&nbsp;b&nbsp;=&nbsp;15&nbsp;&nbsp;true,&nbsp;&nbsp;false&nbsp;&nbsp;&nbsp;分支一 TestCase1:&nbsp;a&nbsp;=&nbsp;15,&nbsp;b&nbsp;=&nbsp;5&nbsp;&nbsp;false,&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;分支一 &nbsp; 我们看到，虽然我们完整的做到了条件覆盖，但是我们却没有做到完整的判定覆盖，我们只覆盖了分支一。上面的例子也可以看出，这两种覆盖方式看起来似乎都不咋滴。我们接下来看看第四种覆盖方式。 4.</p>
</div>


  </div>
  
</article>



                    
                      </div>
                    
                  
                
                  
                    
                      <div class="post-row">
                    

                      <article class="post type-post status-publish format-standard has-post-thumbnail hentry group">
  <div class="post-inner post-hover">
    <div class="post-meta group">
  <p class="post-category">
    
    <a href="http://blog.coderzh.com/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/" title="All posts in 技术文章" rel="category tag">技术文章</a>
    
  </p>

  <p class="post-date">2009年03月21日</p>
</div>

<h2 class="post-title">
  <a href="http://blog.coderzh.com/2009/03/21/1418355" rel="bookmark" title="代码覆盖率工具大全">代码覆盖率工具大全</a>
</h2>

<div class="entry excerpt">
  <p>BullseyeCoverage Kind of Tool Code Coverage Analyzer for C++/C Organization Bullseye Testing Technology http://www.bullseye.com/ Software Description BullseyeCoverage is a full-featured code coverage analyzer for C++/C running on Microsoft and Unix operating systems. BullseyeCoverage quickly finds untested code and measures testing completeness. BullseyeCoverage increases testing productivity by showing you the regions of your source code that are not adequately tested. Platforms Windows and Unix Entry updated January 7, 2003. Insure++ **Kind of Tool** Runtime error detection, memory monitor, coverage analysis **Organization** [ParaSoft Corporation](http://www.testingfaqs.org/vendors/1125.html) [http://www.parasoft.com/](http://www.parasoft.com/) **Software Description** Insure++ is a powerful automatic runtime error detection tool for C/C++ that improves software quality, accelerates time to market, and reduces development costs.</p>
</div>


  </div>
  
</article>



                    
                  
                
                  
                    

                      <article class="post type-post status-publish format-standard has-post-thumbnail hentry group">
  <div class="post-inner post-hover">
    <div class="post-meta group">
  <p class="post-category">
    
    <a href="http://blog.coderzh.com/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/" title="All posts in 技术文章" rel="category tag">技术文章</a>
    
  </p>

  <p class="post-date">2009年03月19日</p>
</div>

<h2 class="post-title">
  <a href="http://blog.coderzh.com/2009/03/19/1416192" rel="bookmark" title="最近遇到个关于接口的奇怪的问题">最近遇到个关于接口的奇怪的问题</a>
</h2>

<div class="entry excerpt">
  <p>接口的作用众所周知了，而且C#的接口，必须明确两点： 1.必须实现接口中定义的方法、属性等，原型必须一样（返回值类型、函数名，参数类型） 2.实现接口的类中必须使用public修饰符 那我们下面来看一个例子： var&nbsp;array&nbsp;=&nbsp;new&nbsp;string[10]; foreach&nbsp;(var&nbsp;tp&nbsp;in&nbsp;array.GetType().GetInterfaces()) { &nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(tp.Name); } &nbsp; 上面的例子取出了对象array实现的所有接口名称，我们看到有下面这些： &nbsp; ICloneable IList ICollection IEnumerable IList`1 ICollection`1 IEnumerable`1 我们看到array实现了ICollection接口，我们跳到这个接口代码区看下： [ComVisible(true)] public&nbsp;interface&nbsp;ICollection&nbsp;:&nbsp;IEnumerable { &nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;Count&nbsp;{&nbsp;get;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;IsSynchronized&nbsp;{&nbsp;get;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;SyncRoot&nbsp;{&nbsp;get;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;CopyTo(Array&nbsp;array,&nbsp;int&nbsp;index); } &nbsp; 我们发现上面有个Count属性，这个&#8230;&#8230;我们都知道string[]类型的对象是不会有Count属性的，只会有Length属性。 这样的话，其实已经违背了上面列的两条了。而且我发现在NHibernate里面也有一个这样的类，实现了IEnumerable接口，却没有提供IEnumerator GetEnumerator()的实现。 这就是我百思不得其解的地方。查了些资料，没找到合理解释，希望谁能来解释一下！</p>
</div>


  </div>
  
</article>



                    
                      </div>
                    
                  
                
              </div>

              
              

<nav class="pagination group">
  <div class="wp-pagenavi">
    <span class="pages">
        Page 20 of 38
        (265 Posts)
    </span>
    
      <a class="previouspostslink" rel="prev" href="http://blog.coderzh.com/paginator/19/">Prev &laquo;</a>
    
    
    
      <a class="nextpostslink" rel="next" href="http://blog.coderzh.com/paginator/21/">Next &raquo;</a>
    
  </div>
</nav>

              
            </div>

          </section>
          <div class="sidebar s1">

  <a class="sidebar-toggle" title="Expand Sidebar"><i class="fa icon-sidebar-toggle"></i></a>

  <div class="sidebar-content">

    <div class="sidebar-top group">
      <p>Follow:</p>
      <ul class="social-links">
    <li>
    <a class="social-tooltip" title="On Twitter"
        href="https://twitter.com/coderzh" target="_blank">
        <i class="fa fa-twitter"></i>
    </a>
    </li>
    <li>
    <a class="social-tooltip" title="On GitHub"
        href="https://github.com/coderzh" target="_blank">
        <i class="fa fa-github"></i>
    </a>
    </li>
</ul>

    </div>

    <div class="widget qrcode">
    <img src="http://blog.coderzh.com/public/qrcode.jpg" width="129px" height="129px"/>
    <p>微信扫一扫：<br/> 关注我的公众号： <br /> hacker-thinking</p>
</div>


    <div class="widget widget_recent_entries sidebarLeftCategories"><h3>Last posts</h3>
      <ul>
        
        <li><a href="http://blog.coderzh.com/2015/08/16/Books">最近读的几本书</a></li>
        
        <li><a href="http://blog.coderzh.com/2015/08/15/JekyllReadMore">使用Jekyll官方的ReadMore摘要功能</a></li>
        
        <li><a href="http://blog.coderzh.com/2015/08/15/ThreadSanitizer">使用ThreadSanitizer线程检查工具</a></li>
        
        <li><a href="http://blog.coderzh.com/2015/08/08/IDonnotCare">你说我是错的，那你最好证明你是对的</a></li>
        
        <li><a href="http://blog.coderzh.com/2015/06/28/163GameOpenDay">小记：网易游戏学院第二届公开日</a></li>
        
      </ul>
    </div>

    <div id="search-2" class="widget widget_search"><h3>Search</h3>

      <form method="get" class="searchform themeform" action="https://www.google.com/search">
        <div>
          <input type="text" class="search" name="q" placeholder="Press enter to start searching">
        </div>
      </form>
    </div>

  </div>
  
</div>

          <div class="sidebar s2">

  <a class="sidebar-toggle" title="Expand Sidebar"><i class="fa icon-sidebar-toggle"></i></a>

  <div class="sidebar-content">

    <div class="sidebar-top group">
      <p>More</p>
    </div>


    <div id="categories-2" class="widget widget_categories"><h3>Categories</h3>
      <ul>
        
          <li class="cat-item cat-item-1">
            <a href="http://blog.coderzh.com/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a>
          </li>
        
          <li class="cat-item cat-item-1">
            <a href="http://blog.coderzh.com/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/">技术文章</a>
          </li>
        
          <li class="cat-item cat-item-1">
            <a href="http://blog.coderzh.com/categories/%E6%80%9D%E8%80%83%E6%84%9F%E6%82%9F/">思考感悟</a>
          </li>
        
      </ul>
    </div>

    <div id="tag_cloud-2" class="widget widget_tag_cloud"><h3>Tags</h3>

      <div class="tagcloud">
        <p class="post-tags">
          
              
          
        </p>
      </div>
    </div>
  </div>
  
</div>

        </div>
      </div>
    </div>
  </div>
  <footer id="footer">

  <nav class="nav-container group" id="nav-footer">
    <div class="nav-toggle"><i class="fa fa-bars"></i></div>
    <div class="nav-text"></div>
    <div class="nav-wrap">
      <ul id="menu-default-menu-1" class="nav container group">
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a href="http://blog.coderzh.com/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0">读书笔记</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a href="http://blog.coderzh.com/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0">技术文章</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a href="http://blog.coderzh.com/categories/%E6%80%9D%E8%80%83%E6%84%9F%E6%82%9F">思考感悟</a>
        </li>
        
      </ul>
    </div>
  </nav>
  

  <section class="container" id="footer-bottom">
    <div class="container-inner">
      <a id="back-to-top" href="#"><i class="fa fa-angle-up"></i></a>
      <div class="pad group">
        <div class="grid one-half">
          <div id="copyright">
            <p>Copyright © 2015. All Rights Reserved. <br>Powered by
              <a href="http://gohugo.io/" target="_blank">Hugo - the static site generator</a>.
              <a href="http://golang.org" target="_blank">#golang</a>.
            </p>
          </div>
          
        </div>
        
        <div class="grid one-half last">
          <ul class="social-links">
    <li>
    <a class="social-tooltip" title="On Twitter"
        href="https://twitter.com/coderzh" target="_blank">
        <i class="fa fa-twitter"></i>
    </a>
    </li>
    <li>
    <a class="social-tooltip" title="On GitHub"
        href="https://github.com/coderzh" target="_blank">
        <i class="fa fa-github"></i>
    </a>
    </li>
</ul>

        </div>
      </div>

    </div>
    
  </section>
  

</footer>

</div>
<script type="text/javascript" src="assets/js/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="wp-content/themes/hueman/js/jquery.jplayer.min.js"></script>
<script type="text/javascript" src="wp-content/themes/hueman/js/scripts.js"></script>
<script type="text/javascript" src="assets/picturefill/picturefill.min.js"></script>
<script type="text/javascript" src="assets/hubinfo/dist/hubinfo.js"></script>
<script type="text/javascript" src="assets/js/jquery.matchHeight-min.js"></script>


<script type="text/javascript">var bU = "http:\/\/blog.coderzh.com/wp-content/plugins/wp-youtube-lyte/lyte/";</script>
<script type="text/javascript" async defer src="wp-content/plugins/wp-youtube-lyte/lyte/lyte.js"></script>
<script type="text/javascript" async defer src="assets/js/myblog.js"></script>

<p style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=1255412532&web_id=1255412532" language="JavaScript"></script>
</p>
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?68fd62d49287d249b4317c5035837c88";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
    })();
</script>

</body>
</html>

